<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <title>用户中心</title>
    <link href="<?php echo base_url().'style/admin/';?>bootstrap-3.3.5-dist/css/bootstrap.min.css" title=""
          rel="stylesheet"/>
    <link title="" href="<?php echo base_url().'style/admin/';?>css/style.css" rel="stylesheet" type="text/css"/>
    <link title="blue" href="<?php echo base_url().'style/admin/';?>css/dermadefault.css" rel="stylesheet"
          type="text/css"/>
    <link title="green" href="<?php echo base_url().'style/admin/';?>css/dermagreen.css" rel="stylesheet"
          type="text/css" disabled="disabled"/>
    <link title="orange" href="<?php echo base_url().'style/admin/';?>css/dermaorange.css" rel="stylesheet"
          type="text/css" disabled="disabled"/>
    <link href="<?php echo base_url().'style/admin/';?>css/templatecss.css" rel="stylesheet" title="" type="text/css"/>
    <script src="<?php echo base_url().'style/admin/';?>script/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="<?php echo base_url().'style/admin/';?>script/jquery.cookie.js" type="text/javascript"></script>
    <script src="<?php echo base_url().'style/admin/';?>bootstrap-3.3.5-dist/js/bootstrap.min.js"
            type="text/javascript"></script>
</head>

<body>
<nav class="nav navbar-default navbar-mystyle navbar-fixed-top">
    <div class="navbar-header">
        <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand mystyle-brand"><span class="glyphicon glyphicon-home"></span></a></div>
    <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
            <li class="li-border"><a class="mystyle-color" href="<?php echo site_url().'/admin/index/';?>">论坛管理控制台</a>
            </li>
        </ul>

        <ul class="nav navbar-nav pull-right">
            <li class="dropdown li-border">
                <a href="#" class="dropdown-toggle mystyle-color" data-toggle="dropdown">
                    <?php echo $this->session->admin_username; ?>
                    <span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="<?php echo site_url().'/admin_login/exit_forum';  ?>">退出</a></li>
                </ul>
            </li>
            <li class="dropdown"><a href="#" class="dropdown-toggle mystyle-color" data-toggle="dropdown">换肤<span
                    class="caret"></span></a>
                <ul class="dropdown-menu changecolor">
                    <li id="blue"><a href="#">蓝色</a></li>
                    <li class="divider"></li>
                    <li id="green"><a href="#">绿色</a></li>
                    <li class="divider"></li>
                    <li id="orange"><a href="#">橙色</a></li>
                </ul>
            </li>
        </ul>
    </div>
</nav>
<div class="down-main">
    <div class="left-main left-full">
        <div class="sidebar-fold"><span class="glyphicon glyphicon-menu-hamburger"></span></div>
        <div class="subNavBox">
            <div class="sBox">
                <div class="subNav sublist-up"><span class="title-icon glyphicon glyphicon-chevron-up"></span><span
                        class="sublist-title">用户管理</span></div>
                <ul class="navContent" style="display:none">
                    <li class="active">
                        <div class="showtitle" style="width:100px;"><img
                                src="<?php echo base_url().'style/admin/';?>img/leftimg.png"/>用户管理
                        </div>
                        <a href="<?php echo site_url().'/admin_user/user_info_show/';?>"><span
                                class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">用户管理</span></a>
                    </li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img
                                src="<?php echo base_url().'style/admin/';?>img/leftimg.png"/>用户添加
                        </div>
                        <a href="<?php echo site_url().'style/admin/';?>message.html"><span
                                class="sublist-icon glyphicon glyphicon-envelope"></span><span
                                class="sub-title">用户添加</span></a></li>
                    <!--<li>-->
                    <!--<div class="showtitle" style="width:100px;"><img src="<?php echo base_url().'style/admin/';?>img/leftimg.png" />角色管理</div>-->
                    <!--<a href="<?php echo base_url().'style/admin/';?>smsInfo.html"><span class="sublist-icon glyphicon glyphicon-bullhorn"></span><span class="sub-title">角色管理</span></a></li>-->
                    <!--<li>-->
                    <!--<div class="showtitle" style="width:100px;"><img src="<?php echo base_url().'style/admin/';?>img/leftimg.png" />角色添加</div>-->
                    <!--<a href="<?php echo base_url().'style/admin/';?>identify.html"><span class="sublist-icon glyphicon glyphicon-credit-card"></span><span class="sub-title">角色添加</span></a></li>-->
                </ul>
            </div>
            <div class="sBox">
                <div class="subNav sublist-up"><span class="title-icon glyphicon glyphicon-chevron-up"></span><span
                        class="sublist-title">帖子管理</span></div>
                <ul class="navContent" style="display:none">
                    <!--<li>-->
                    <!--<div class="showtitle" style="width:100px;"><img src="<?php echo base_url().'style/admin/';?>img/leftimg.png" />帖子置顶</div>-->
                    <!--<a href="<?php echo site_url().'/admin/post_stick/';?>"><span class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">帖子置顶</span></a></li>-->
                    <li>
                        <div class="showtitle" style="width:100px;"><img
                                src="<?php echo base_url().'style/admin/';?>img/leftimg.png"/>帖子编辑
                        </div>
                        <a href="<?php echo site_url().'/admin_post/post_top_del/';?>"><span
                                class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">帖子编辑</span></a>
                    </li>
                    <li>
                        <div class="showtitle" style="width:100px;"><img
                                src="<?php echo base_url().'style/admin/';?>img/leftimg.png"/>版块管理
                        </div>
                        <a href="<?php echo site_url().'/admin_category/category_show_add/';?>"><span
                                class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">版块管理</span></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="right-product my-index right-full">
        <div class="container-fluid">
            <div class="info-center">

                <!---title----->
                <div class="info-title">
                    <div class="pull-left">
                        <h4><strong>Administrator，</strong></h4>
                        <p>欢迎登录论坛管理系统！</p>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <!----content-list---->

                <div class="admin_edit_post">
                    <p class="admin_edit_post_title">用户管理：</p>
                    <table class="user_manager_table">
                        <thead style="width:100%">
                        <tr class="">
                            <td style="width:15%">用户名</td>
                            <td style="width:15%">密码</td>
                            <td style="width:20%">创建时间</td>
                            <td style="width:15%">状态</td>
                            <td style="width:35%">操作</td>
                        </tr>
                        </thead>
                        <tbody id="user_info">
                        <?php foreach($user_info as $v): ?>
                        <tr id="<?php echo $v['uid'];?>">
                            <td>
                                <?php echo $v['username'];?>
                            </td>
                            <td>
                                <?php echo $v['password'];?>
                            </td>
                            <td>
                                <?php echo $v['createtime'];?>
                            </td>
                            <td>
                                <?php if($v['state'] == 0)echo "屏蔽";
                                        else echo "开启";?>
                            </td>
                            <td>
                                <button name="delete" onclick="delete_user(<?php echo $v['uid'];?>)" class="delete_user"
                                        value="<?php echo $v['uid'];?>">
                                    删除
                                </button>
                                <button name="edit" onclick="edit_user(<?php echo $v['uid'];?>)" class="edit_user"
                                        value="<?php echo $v['uid'];?>">
                                    编辑
                                </button>
                            </td>
                        </tr>
                        <?php endforeach ?>
                        <!--<tr>-->
                            <!--<td>-->
                                <!--<input type="text" required="required" name="username" placeholder="用户名">-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<input type="text" required="required" name="password" placeholder="密码">-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<?php echo $v['createtime'];?>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<select name="userstate" class="user_state_select">-->
                                    <!--<option value="1">开启</option>-->
                                    <!--<option value="0">屏蔽</option>-->
                                <!--</select>-->
                            <!--</td>-->
                            <!--<td>-->
                                <!--<button name="save" onclick="" class="edit_user_save">-->
                                    <!--保存-->
                                <!--</button>-->
                            <!--</td>-->
                        <!--</tr>-->
                        </tbody>
                    </table>
                </div>


            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        /*换肤*/
        $(".dropdown .changecolor li").click(function () {
            var style = $(this).attr("id");
            $("link[title!='']").attr("disabled", "disabled");
            $("link[title='" + style + "']").removeAttr("disabled");

            $.cookie('mystyle', style, {expires: 7}); // 存储一个带7天期限的 cookie
        })
        var cookie_style = $.cookie("mystyle");
        if (cookie_style != null) {
            $("link[title!='']").attr("disabled", "disabled");
            $("link[title='" + cookie_style + "']").removeAttr("disabled");
        }
        /*左侧导航栏显示隐藏功能*/
        $(".subNav").click(function () {
            /*显示*/
            if ($(this).find("span:first-child").attr('class') == "title-icon glyphicon glyphicon-chevron-down") {
                $(this).find("span:first-child").removeClass("glyphicon-chevron-down");
                $(this).find("span:first-child").addClass("glyphicon-chevron-up");
                $(this).removeClass("sublist-down");
                $(this).addClass("sublist-up");
            }
            /*隐藏*/
            else {
                $(this).find("span:first-child").removeClass("glyphicon-chevron-up");
                $(this).find("span:first-child").addClass("glyphicon-chevron-down");
                $(this).removeClass("sublist-up");
                $(this).addClass("sublist-down");
            }
            // 修改数字控制速度， slideUp(500)控制卷起速度
            $(this).next(".navContent").slideToggle(300).siblings(".navContent").slideUp(300);
        })
        /*左侧导航栏缩进功能*/
        $(".left-main .sidebar-fold").click(function () {

            if ($(this).parent().attr('class') == "left-main left-full") {
                $(this).parent().removeClass("left-full");
                $(this).parent().addClass("left-off");

                $(this).parent().parent().find(".right-product").removeClass("right-full");
                $(this).parent().parent().find(".right-product").addClass("right-off");

            }
            else {
                $(this).parent().removeClass("left-off");
                $(this).parent().addClass("left-full");

                $(this).parent().parent().find(".right-product").removeClass("right-off");
                $(this).parent().parent().find(".right-product").addClass("right-full");

            }
        })

        /*左侧鼠标移入提示功能*/
        $(".sBox ul li").mouseenter(function () {
            if ($(this).find("span:last-child").css("display") == "none") {
                $(this).find("div").show();
            }
        }).mouseleave(function () {
            $(this).find("div").hide();
        })
    })


    //删除用户
    function delete_user(uid) {
        var url = "<?php echo site_url('/admin_user/user_delete');?>";
        $.ajax({
            type: 'POST',
            url: url,
            data: {
                uid: uid
            },
            dataType: "JSON",
            success: function (data) {
                var i;
                var str = '';
                var state ='';
                //alert(data['user_info'][0]["username"]);
                for (i = 0; i < data['user_info'].length; i++) {
                    if (data['user_info'][i]["state"]==0){
                        state = "屏蔽";
                    }else{
                        state = "开启";
                    }
                    str += "<tr id='"+
                        data['user_info'][i]["uid"]+
                        "'><td>" +
                        data['user_info'][i]["username"] +
                        "</td><td>" +
                        data['user_info'][i]["password"] +
                        "</td><td>" +
                        data['user_info'][i]["createtime"] +
                        "</td><td>" +
                        state +
                        "</td><td>" +
                        "<button name='delete' onclick='delete_user("+
                        data['user_info'][i]["uid"]+
                        ")' class='delete_user' value='" +
                        data['user_info'][i]["uid"] +
                        "'>" +
                        "删除</button>" +
                        "<button name='edit' onclick='edit_user("+
                        data['user_info'][i]["uid"]+
                        ")' class='edit_user' value='" +
                        data['user_info'][i]["uid"] + "'>" +
                        "编辑</button>" +
                        "</td></tr>";
                }
                $("#user_info").html(str);
            },
            error: function (msg) {//ajax请求失败后触发的方法
                alert("错误");//弹出错误信息
            }
        });
    }
    //编辑用户
    function edit_user(uid) {
        var url = "<?php echo site_url('/admin_user/get_user_info');?>";
        $.ajax({
            type: 'POST',
            url: url,
            data: {
                uid: uid
            },
            dataType: "JSON",
            success: function (data) {
                var str = "<td>" +
                    "<input type='text' required='required' name='username' placeholder='用户名' " +
                    "value = '" +
                    data['special_user'][0]['username'] +
                    "'>" +
                    "</td><td>" +
                    "<input type='text' required='required' name='password' placeholder='密码' " +
                    "value='" +
                    data['special_user'][0]['password'] +
                    "'>" +
                    "</td><td>" +
                    data['special_user'][0]['createtime'] +
                    "</td><td>" +
                    "<select name='userstate' class='user_state_select'>" +
                    "<option value='1' >开启</option>" +
                    "<option value='0' >屏蔽</option>" +
                    "</select>" +
                    "</td><td>" +
                    "<button name='save' onclick='edit_user_save(" +
                    data['special_user'][0]['uid'] +
                    ")' class='edit_user_save' " +
                    "value='" +
                    data['special_user'][0]['uid'] +
                    "'>" +
                    "保存" +
                    "</button></td>";

                $("#" + data['special_user'][0]['uid']).html(str);
            },
            error: function (msg) {//ajax请求失败后触发的方法
                alert("错误");//弹出错误信息
            }
        });
    }

    //保存修改的用户
    function edit_user_save(uid) {
        var username = document.getElementById(uid).getElementsByTagName("input")[0].value;
        var password = document.getElementById(uid).getElementsByTagName("input")[1].value;
        var select = $('.user_state_select option:selected').val();
        var url = "<?php echo site_url('/admin_user/user_change');?>";
        var str = '';
        $.ajax({
            type: 'POST',
            url: url,
            data: {
                uid: uid,
                username: username,
                password: password,
                select: select
            },
            dataType: "JSON",
            success: function (data) {
                var state = '';
                if (data['special_user'][0]["state"]==0){
                    state = "屏蔽";
                }else{
                    state = "开启";
                }
                str += "<td>" +
                    data['special_user'][0]["username"] +
                    "</td><td>" +
                    data['special_user'][0]["password"] +
                    "</td><td>" +
                    data['special_user'][0]["createtime"] +
                    "</td><td>" +
                    state +
                    "</td><td>" +
                    "<button name='delete' onclick='delete_user("+
                    data['special_user'][0]["uid"]+
                    ")' class='delete_user' value='" +
                    data['special_user'][0]["uid"] +
                    "'>" +
                    "删除</button>" +
                    "<button name='edit' onclick='edit_user("+
                    data['special_user'][0]["uid"]+
                    ")' class='edit_user' value='" +
                    data['special_user'][0]["uid"] + "'>" +
                    "编辑</button>" +
                    "</td>";

                $("#" + data['special_user'][0]['uid']).html(str);
            },
            error: function (msg) {//ajax请求失败后触发的方法
                alert("错误");//弹出错误信息
            }
        });
    }
</script>
</body>
</html>
